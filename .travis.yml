group: deprecated-2017Q4
os:
- linux
- osx
osx_image: xcode6.4
language: c
sudo: required
services:
- docker
env:
  matrix:
    - CUDA_VERSION="7.5" CUDA_SHORT_VERSION="75"
    - CUDA_VERSION="8.0" CUDA_SHORT_VERSION="80"
    - CUDA_VERSION="9.0" CUDA_SHORT_VERSION="90"
    - CUDA_VERSION="9.1" CUDA_SHORT_VERSION="91"
    - CUDA_VERSION="9.2" CUDA_SHORT_VERSION="92"
    - CUDA_VERSION="10.0" CUDA_SHORT_VERSION="100"
  secure: cY4VkJZmTzLh/zCvj+jDw132ibKIWfHOoetpNZBqsb6dNAlrznJm3TdYwPLRMlpXWRytXiXXm7kpQIGglPrBzfIaspCUTvQTiX/a3xU3D0f6gT98eVWOm2i6SobOu6SIzHub1gUy3DyV9r9KIgzrULUukt/EOzDJA+97fLBZOoTLpKU6TYllwJ0M0YdxGcDqNXsx+NOdlfmkRJG+FyAuO8u1Y4iDn4QeQX8nwaS0nw1SCECzLSDG4QkKIu2h2E/p0X7k5nYG7kJUBUCfg8qaKSeoSCCvyEQrTb3hEG5lAvG4wrUKmp2+RtaqBctYbjhGfad8A9FJzr15K77IUPLMQkEWl0j7PXoTLOhpTFJvQIYBAhv+SWCo7+MWL504vgllQDu4zGwCyij8wocoqkOn/gRXslNU9rZpbALm0yT6kHLiHy1PnZv4T9xrxolST4XFVTrcgL7OKqBR9eTrk0di3KrkIa8DcdBihKI/tZRaI3132oaAkf50dPsyRZ1SEryQgKdrkH4lt4xDc0rrD0vuOnMJp6+lviz9diL39Pcd5WAse2vTNwgd3xMeprvXjvCfRoqkYCfhCbJaO6W/nuwGU8J2WWna7C7SwQyEQrdLlS15N51LZ/uTHQs7tuSiH01kTyATkcnNLXG2c8cjN5YsQlGuhvaDtLIKQT8JiINaBN8=
install:
- export DOCKER_IMAGE="jchodera/omnia-linux-anvil:texlive18-cuda${CUDA_SHORT_VERSION}"
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then docker pull ${DOCKER_IMAGE}; fi
script:
- chmod +x conda-build-all
- export CHECK_AGAINST="--check-against pgrinaway --check-against pgrinaway/label/cuda${CUDA_SHORT_VERSION}"
- export CHECK_AGAINST="$CHECK_AGAINST --check-against pgrinaway/label/beta --check-against
  pgrinaway/label/betacuda${CUDA_SHORT_VERSION}"
- export CHECK_AGAISNT="$CHECK_AGAINST --check-against pgrinaway/label/dev --check-against
  pgrinaway/label/devcuda${CUDA_SHORT_VERSION}"
- if [[ "${TRAVIS_PULL_REQUEST}" == "false" && "${TRAVIS_BRANCH}" == "master" ]];
  then export UPLOAD="--upload pgrinaway"; else export UPLOAD="%CHECK_AGAINST"; fi
- echo $UPLOAD
- |-
  if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
  docker run -e UPLOAD -e BINSTAR_TOKEN -e CUDA_VERSION -e CUDA_SHORT_VERSION -e TRAVIS_PULL_REQUEST -t -i --rm -v `pwd`:/io ${DOCKER_IMAGE} bash /io/devtools/docker-build.sh;
  elif [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
  echo "Building osx..."; export NVIDIA_CACHE=$HOME/nvidia_cache; bash devtools/osx-build.sh;
  fi
